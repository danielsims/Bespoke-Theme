[%if [@config:current_page_type@] eq 'category' OR [@config:current_page_type@] eq 'content'%]
	[%if [@config:show_filters@]%]
		[%site_value id:'footer_javascript'%]
			<script>
				// Infinite Scroll
				var maximumResults = Number($("meta[name='infinite-data']").attr('total-results'));
				var counter = Number($("meta[name='infinite-data']").attr('counter'));
				var currentResults = counter;

				$.load_ajax_template('_products_infinite', {limit_update: currentResults}, {
					onLoad: function(templateContent){
						// Sidebar Toggling
						$(document).on('click', '#sidebarToggle', function(){
							if($(this).html() == "Show Sort") {
								$('#filters').addClass('show');
								$(this).html("Hide Sort");
							} else {
								$('#filters').removeClass('show');
								$(this).html("Show Sort");
							}

							$("#left-sidebar").toggleClass("sidebar-collapsed");
							$("#category-content").toggleClass("col-md-6 col-lg-8");
							$("#category-content .wrapper-thumbnail-toggle").toggleClass("col-md-12 col-lg-4 col-lg-6");
						});
					}
				});

				// Reload ajax template with a multiple of 'infinite_products_counter'
				$('#infinite_trigger').on('click', function(){
					$('#infinite_trigger_load').removeClass('d-none');
					$('#infinite_trigger').addClass('d-none');

					currentResults = currentResults + counter;

					$.load_ajax_template('_products_infinite', {limit_update: currentResults}, {
						onLoad: function(templateContent){
							if (currentResults >= maximumResults) {
								$('#infinite_trigger').addClass('d-none');
								$('#infinite_trigger_load').addClass('d-none');
							} else {
								$('#infinite_trigger_load').addClass('d-none');
								$('#infinite_trigger').removeClass('d-none');
							}
						}
					});
				});
			</script>
		[%/site_value%]
	[%/if%]

	<div class="wrapper-category-products row">
		<div class="col-12 mb-5">
			[@^section-title@]
			[%if [@config:show_filters@]%]
				<btn id="sidebarToggle" class="btn btn-outline-dark px-5 mt-2">Show Sort</btn>
			[%/if%]
		</div>

		[%if [@config:show_filters@]%]
			[%load_template file:'cms/includes/sidebar.template.html'/%]
		[%else%]
			<div id="category-content" class="col-12 text-center">
		[%/if%]
				[%load_ajax_template id:'_products_infinite' type:'content' template:'products_infinite' preload:'1' tmpl_sku:'[@^^category_id@]' tmpl_preview:'y'/%]
			</div><!-- /#category-content -->
	</div>
	<button id="infinite_trigger" class="btn btn-success text-uppercase">Load More Products</button>
	<button id="infinite_trigger_load" class="btn btn-success text-uppercase d-none"><i class='fa fa-spinner fa-spin' style='font-size: 14px'></i> <span class="pl-2">Loading...</span></button>
[%/if%]